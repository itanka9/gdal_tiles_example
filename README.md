# Генерация растровых тайлов при помощи GDAL

В этом репозитории реализован пример генерации растровых тайлов при помощи GDAL. Генерируются тайлы на основе картинок из https://visibleearth.nasa.gov/images/57752/blue-marble-land-surface-shallow-water-and-shaded-topography

Для генерации на машине должны присутствовать утилиты GDAL, в частности должны быть доступны команды `gdal_translate` и `gdal2tiles.py`.

Генерация происходит в каталог `tiles`, для ее запуска достаточно набрать 

```
make
```

Чтобы посмотреть результат, нужно раздать каталог `tiles` по HTTP, а потом зайти по адресу

```
http://localhost:8080/leaflet.html
```

(в меню справа нужно поставить галочку напротив пункта `Layer`).

## Как происходит генерация

Исходными данными для примера являются две картинки - для восточного и западного полушарий. Это обычные изображения в формате TIFF, так что перед использованием мы должны привзать их к географическим координатам и указать проекцию. Это делается при помощи `gdal_translate`. Например для восточного полушария

```
gdal_translate -of GTiff -a_srs WGS84 -a_ullr 0 90 180 -90 east_raw.tif east_annotated.tif
```

После получения аннотированных файлов, можно переходить к генерации. Она производится утилитой `gdal2tiles.py` следующим образом

```
gdal2tiles.py --xyz east.tif tiles/
```

Эта команда генерирует тайлы из изображения `east.tif` в каталог `tiles`. Опция `--xyz` говорит, что генерировать надо в ZXY формате, пригодном для использования веб-картах (leaflet, openlayers и нашей webgl-карте).

## Изображения в различных проекциях

Если исходное изображение в другой проекции, его предварительно нужно сконвертировать в нужную при помощи утилиты `gdalwarp`, каким-то подобным образом.

```
gdalwarp -s_srs EPSG:4326 -t_srs EPSG:3857 in.tif out.tif
```